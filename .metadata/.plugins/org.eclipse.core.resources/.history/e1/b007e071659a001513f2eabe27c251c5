package controllers;

import static spark.Spark.*;

import adapters.ContactRepository;
import models.Contact;
import spark.Request;
import spark.template.freemarker.FreeMarkerEngine;

public class ContactsController {

	private ContactRepository contactRepository = new ContactRepository();

	public ContactsController(FreeMarkerEngine freeMarkerEngine) {
		get("/contacts/create", (request, response)-> {
			return modelAndView(null, "contact_form.ftl");
		}, freeMarkerEngine);		
		
		post("/contacts/create", (request, response)-> {
			
			String name=request.queryParams("name");
			String email=request.queryParams("email");
			String message=request.queryParams("message");

			Contact newContact=contactRepository.save(new Contact(name, email, message));

			response.redirect("/contacts/thankyou/"+newContact.getId(), 301);
			return "";
		});		

		get("/contacts/thankyou/:id", (request, response)-> {
			String id=request.params("id");
			//Retrieve contact repo
			Contact contact=new Contact("jose","josecgil@smokingbrains.com", "message"); 
			contact.setId(999);
			return modelAndView(contact, "thank_you.ftl");
		}, freeMarkerEngine);		

	}

}
